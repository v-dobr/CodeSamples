# Пример фрагментов кода Microsoft Graph на Swift для iOS

**Содержание**

* [Введение](#Введение)
* [Необходимые компоненты](#Необходимые-компоненты)
* [Регистрация и настройка приложения](#Регистрация-и-настройка-приложения)
* [Сборка и отладка](#Сборка-и-отладка)
* [Полезный код](#Полезный-код)
* [Запуск приложения](#Запуск-приложения)
* [Вопросы и комментарии](#Вопросы-и-комментарии)
* [Дополнительные ресурсы](#Дополнительные-ресурсы)

<a name="introduction"></a>
##Введение

Этот пример содержит репозиторий фрагментов кода, которые показывают, как использовать пакет SDK Microsoft Graph, чтобы отправлять сообщения электронной почты, управлять группами и выполнять другие действия с данными Office 365. Для работы с данными, возвращаемыми Microsoft Graph, используется [пакет SDK Microsoft Graph для iOS](https://github.com/microsoftgraph/msgraph-sdk-ios).

Этот репозиторий показывает, как получить доступ к нескольким ресурсам, в том числе Microsoft Azure Active Directory (AD) и API Office 365, совершая HTTP-запросы в API Microsoft Graph в приложении iOS. 

Кроме того, для проверки подлинности в примере используется [msgraph-sdk-ios-nxoauth2-adapter](https://github.com/microsoftgraph/msgraph-sdk-ios-nxoauth2-adapter). Чтобы отправлять запросы, необходимо указать протокол **MSAuthenticationProvider**, который способен проверять подлинность HTTPS-запросов с помощью соответствующего токена носителя OAuth 2.0. Мы будем использовать эту платформу для реализации протокола MSAuthenticationProvider и быстрого запуска проекта.

 > **Примечание.** **msgraph-sdk-ios-nxoauth2-adapter** — это пример реализации OAuth для проверки подлинности в этом приложении, который используется в целях демонстрации.

Эти фрагменты простые и автономные. Вы можете копировать их в свой код или брать их за основу при изучении Microsoft Graph SDK для iOS.

**Примечание.** Если возможно, используйте этот пример с "нерабочей" или тестовой учетной записью. Если вы используете пример, созданные объекты в почтовом ящике и календаре не всегда очищаются. В настоящее время вам необходимо вручную удалить примеры сообщений и событий календаря. Обратите внимание, что фрагменты кода, которые используются для получения и отправки сообщений, а также получения, создания, обновления и удаления событий, работают не со всеми личными учетными записями. Настоящие операции будут поддерживаться в полном объеме, когда эти учетные записи будут обновлены для работы с конечной точкой проверки подлинности версии 2.

 

<a name="prerequisites"></a>
## Необходимые компоненты ##

Для этого примера требуется следующее:  
* [Xcode](https://developer.apple.com/xcode/downloads/) от Apple.
* Установка [CocoaPods](https://guides.cocoapods.org/using/using-cocoapods.html) в качестве диспетчера зависимостей.
* Рабочая или личная учетная запись Майкрософт, например Office 365, outlook.com или hotmail.com. Вы можете [подписаться на план Office 365 для разработчиков](https://aka.ms/devprogramsignup), который включает ресурсы, необходимые для создания приложений Office 365.
* Идентификатор клиента из приложения, зарегистрированного на [портале регистрации приложений Microsoft Graph](https://graph.microsoft.io/en-us/app-registration)
* Как указывалось выше, для отправки запросов на проверку подлинности необходимо указать протокол **MSAuthenticationProvider**, который способен проверять подлинность HTTPS-запросов с помощью соответствующего маркера носителя OAuth 2.0. 


      
<a name="register"></a>
##Регистрация и настройка приложения

1. Войдите на [портал регистрации приложений](https://apps.dev.microsoft.com/) с помощью личной, рабочей или учебной учетной записи.  
2. Выберите пункт **Добавить приложение**.  
3. Введите имя приложения и выберите пункт **Создать приложение**. Откроется страница регистрации со свойствами приложения.  
4. В разделе **Платформы** выберите пункт **Добавление платформы**.  
5. Выберите пункт **Мобильное приложение**.  
6. Скопируйте идентификатор клиента (идентификатор приложения) для дальнейшего использования. Это значение потребуется ввести в примере приложения. Идентификатор приложения является уникальным.   
7. Нажмите кнопку **Сохранить**.  


<a name="build"></a>
## Сборка и отладка ##

1. Клонируйте этот репозиторий.
2. Импортируйте зависимости Microsoft Graph SDK и проверки подлинности с помощью CocoaPods:

        pod 'MSGraphSDK'
        pod 'MSGraphSDK-NXOAuth2Adapter'


 Этот пример приложения уже содержит podfile, который добавит компоненты pod в проект. Просто перейдите к проекту в **Терминале** и выполните следующую команду:

        pod install

   Для получения дополнительных сведений выберите ссылку **Использование CocoaPods** в разделе [Дополнительные ресурсы](#Дополнительные-ресурсы).

3. Откройте **Graph-iOS-Swift-Snippets.xcworkspace**.
4. Откройте **ApplicationConstants.swift**. Вы увидите, что в верхнюю часть файла можно добавить **идентификатор клиента**, скопированный в ходе регистрации.
   ```swift
   // You will set your application's clientId
   static let clientId = "ENTER_CLIENT_ID"    
   ```
    > Примечание. Дополнительные сведения об областях разрешений, необходимых для использования этого примера, см. ниже в разделе **Выполнение примера**.
5. Запустите приложение.

## Полезный код
Весь код для проверки подлинности можно найти в файле **Authentication.swift**. Мы используем протокол MSAuthenticationProvider из файла NXOAuth2Client для поддержки входа в зарегистрированных собственных приложениях, автоматического обновления токенов доступа и выхода.
Идентификатор клиента и разрешения, используемые в этом примере, определены в файле **ApplicationConstants.swift**.

Все фрагменты расположены в разделе **Graph-iOS-Swift-Snippets/Snippets** в навигаторе проекта.
- Файл **Snippet.swift** содержит протоколы, перечисления и структуры, используемые для создания списка фрагментов, который будет использоваться в приложении.
- Файл **UserSnippets.swift** содержит фрагменты, связанные с пользователями.
- Файл **GroupsSnippets.swift** содержит фрагменты, связанные с группами.

## Запуск приложения

Когда вы запустите приложение, в нем появится список типичных задач. Доступные задачи будут зависеть от типа учетной записи и уровня разрешений и отражены в примечаниях:

- Задачи, доступные для рабочих, учебных и личных учетных записей, например получение и отправка электронной почты, создание файлов и т. д.
- Задачи, доступные только для рабочих или учебных учетных записей, например получение фотографии учетной записи или сведений о руководителе пользователя.
- Задачи, доступные только для рабочей или учебной учетной записи с административными разрешениями, например получение сведений о членах группы или создание учетных записей пользователей.

Выберите задачу, которую необходимо выполнить, и щелчком запустите ее. Обратите внимание, что при входе в систему с помощью учетной записи, не имеющей соответствующих разрешений для выбранных задач, последние невозможно выполнить. Например, если вы попытаетесь выполнить определенный фрагмент кода (например, получить все клиентские группы) из учетной записи без прав администратора в организации, операция завершится ошибкой. Если вы войдете в систему с помощью личной учетной записи, например hotmail.com, вам не удастся получить сведения о руководителе пользователя, который вошел в систему.

В настоящее время для этого примера приложения в файле ApplicationConstants.swift настроены следующие разрешения:

    "https://graph.microsoft.com/User.Read",
    "https://graph.microsoft.com/User.ReadWrite",
    "https://graph.microsoft.com/User.ReadBasic.All",
    "https://graph.microsoft.com/Mail.Send",
    "https://graph.microsoft.com/Calendars.ReadWrite",
    "https://graph.microsoft.com/Mail.ReadWrite",
    "https://graph.microsoft.com/Files.ReadWrite",

Вы сможете выполнить несколько операций, просто используя указанные выше разрешения. Однако есть задачи, для правильного выполнения которых требуются права администратора. Такие задачи будут помечены в пользовательском интерфейсе как требующие доступа администратора. Администраторы могут добавить в Authentication.constants.m следующие области, чтобы выполнить эти фрагменты кода:

    "https://graph.microsoft.com/Directory.AccessAsUser.All",
    "https://graph.microsoft.com/User.ReadWrite.All"
    "https://graph.microsoft.com/Group.ReadWrite.All"

Фрагменты, которые можно выполнять в учетных записях администратора, организации и личных учетных записях, см. в файлах UserSnippets.swift и GroupsSnippets.swift в разделе Graph-iOS-Swift-Snippets/Snippets в навигаторе проекта. В каждом описании фрагмента кода указывается уровень доступа.

<a name="contributing"></a>
## Добавление кода ##

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [правилам поведения Майкрософт, касающимся обращения с открытым кодом](https://opensource.microsoft.com/codeofconduct/). Читайте дополнительные сведения в [разделе вопросов и ответов по правилам поведения](https://opensource.microsoft.com/codeofconduct/faq/) или отправляйте новые вопросы и замечания по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

<a name="questions"></a>
## Вопросы и комментарии

Мы будем рады узнать ваше мнение о проекте библиотеки фрагментов кода Microsoft Graph для UWP. Вы можете отправлять нам вопросы и предложения на вкладке [Issues](https://github.com/microsoftgraph/iOS-objectiveC-snippets-sample/issues) этого репозитория.

Ваше мнение важно для нас. Для связи с нами используйте сайт [Stack Overflow](http://stackoverflow.com/questions/tagged/office365+or+microsoftgraph). Помечайте свои вопросы тегом [MicrosoftGraph].

<a name="additional-resources"></a>
## Дополнительные ресурсы ##

- [Общие сведения о Microsoft Graph](http://graph.microsoft.io)
- [Примеры кода приложений для Office](http://dev.office.com/code-samples)
- [Центр разработки для Office](http://dev.office.com/)


## Авторское право
(c) Корпорация Майкрософт (Microsoft Corporation), 2016. Все права защищены.